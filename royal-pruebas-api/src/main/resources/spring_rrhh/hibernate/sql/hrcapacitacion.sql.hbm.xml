<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">

<hibernate-mapping>
	<sql-query name="hrcapacitacion.contarPaginacion">
		SELECT
		COUNT(1)
		FROM 
		HR_CAPACITACION C
		WHERE 
		C.CAPACITACION = ISNULL(:p_capacitacion, C.CAPACITACION)
		AND C.CompanyOwner = ISNULL(:p_compania, C.CompanyOwner)
		AND C.Estado = ISNULL(:p_estado, C.Estado)
		AND CAST(C.FechaSolicitud AS DATE) BETWEEN CAST(ISNULL(:p_desde, C.FechaSolicitud) AS DATE) AND CAST(ISNULL(:p_hasta, C.FechaSolicitud) AS DATE)
		AND C.EmpleadoSolicitante = :p_solicitante
	</sql-query>
	<sql-query name="hrcapacitacion.listarPaginacion">
		SELECT
		C.curso "curso",
		C.capacitacion AS "capacitacion",
		C.companyOwner AS "companyOwner",
		C.descripcion AS "descripcion",
		cast(C.estado as varchar(1)) AS "estado",
		C.fechaDesde AS "fechaDesde",
		C.fechaHasta AS "fechaHasta",
		C.ultimoUsuario AS "ultimoUsuario",
		C.ultimaFechaModif AS "ultimaFechaModif",
		C.fechaSolicitud "fechaSolicitud",
		C.empleadoSolicitante "empleadoSolicitante",
		S.NombreCompleto AS "auxSolicitanteNombre",
		cast(ES.DescripcionLocal as varchar) AS "auxEstadoNombre",
		CU.Descripcion as "auxCursoNombre",
		(SELECT COUNT (1) FROM HR_EmpleadoCapacitacion EM WHERE EM.CompanyOwner = C.CompanyOwner AND EM.Capacitacion = C.Capacitacion) AS "auxCantidadParticipantes"
		FROM 
		HR_CAPACITACION C
		LEFT JOIN PersonaMast S ON S.Persona = C.EmpleadoSolicitante
		LEFT JOIN HR_CursoDescripcion CU ON CU.Curso = C.Curso
		LEFT JOIN MA_MiscelaneosDetalle ES ON ES.AplicacionCodigo = 'HR' AND ES.CodigoTabla = 'CAPACESTA' AND ES.Compania = '999999' AND ES.CodigoElemento = C.Estado
		WHERE 
		C.CAPACITACION = ISNULL(:p_capacitacion, C.CAPACITACION)
		AND C.CompanyOwner = ISNULL(:p_compania, C.CompanyOwner)
		AND C.Estado = ISNULL(:p_estado, C.Estado)
		AND CAST(C.FechaSolicitud AS DATE) BETWEEN CAST(ISNULL(:p_desde, C.FechaSolicitud) AS DATE) AND CAST(ISNULL(:p_hasta, C.FechaSolicitud) AS DATE)
		AND C.EmpleadoSolicitante = :p_solicitante
	</sql-query>
	<sql-query name="hrcapacitacion.generarCodigo">
		DECLARE @UNIDAD VARCHAR(10)= :p_unidad
		DECLARE @COMPANIA VARCHAR(10)= :p_compania
		
		select @UNIDAD + RIGHT('000000'+CAST((ISNULL(MAX(CAST(SUBSTRING(Capacitacion, 5, 6) AS INT)), 0) + 1) AS VARCHAR(6)),6) AS "codigo" from HR_CAPACITACION
		WHERE CompanyOwner = @COMPANIA
	</sql-query>
	<sql-query name="hrcapacitacion.obtenerDto">
		select
		c.capacitacion as "capacitacion",
		c.companyOwner as "companyOwner",
		c.Curso as "curso",
		c.Descripcion as "descripcion",
		cast(c.Estado as varchar) as "estado",
		c.FechaSolicitud as "fechaSolicitud",
		c.FechaDesde  as "fechaDesde",
		c.FechaHasta  as "fechaHasta",
		c.EmpleadoSolicitante  as "empleadoSolicitante",
		c.UltimoUsuario as "ultimoUsuario",
		c.ultimaFechaModif  as "ultimaFechaModif",
		S.NombreCompleto AS "auxSolicitanteNombre",
		cast(ES.DescripcionLocal as varchar) AS "auxEstadoNombre",
		CU.Descripcion as "auxCursoNombre"
		from hr_capacitacion c
		LEFT JOIN PersonaMast S ON S.Persona = C.EmpleadoSolicitante
		LEFT JOIN HR_CursoDescripcion CU ON CU.Curso = C.Curso
		LEFT JOIN MA_MiscelaneosDetalle ES ON ES.AplicacionCodigo = 'HR' AND ES.CodigoTabla = 'CAPACESTA' AND ES.Compania = '999999' AND ES.CodigoElemento = C.Estado
		where c.companyowner = :p_compania and c.capacitacion = :p_capacitacion
	</sql-query>
	
	
	<sql-query name="hrcapacitacion.paginadoCursoListar">
	  select 
		Curso id,
		Descripcion descripcion
		from HR_CursoDescripcion 
		where Estado='A'
		AND  ISNULL(Descripcion,'ddd') LIKE '%' + ISNULL(:p_descripcion, ISNULL(Descripcion,'ddd') ) + '%'
		AND Curso=ISNULL(:p_curso,Curso)
	</sql-query>
	
	<sql-query name="hrcapacitacion.paginadoCursoContar">
	  select 
		COUNT(1)
		from HR_CursoDescripcion 
		where Estado='A'
		AND  ISNULL(Descripcion,'ddd') LIKE '%' + ISNULL(:p_descripcion, ISNULL(Descripcion,'ddd') ) + '%'
		AND Curso=ISNULL(:p_curso,Curso)
	</sql-query>
	
	
	<sql-query name="hrcapacitacion.paginadoEmpleadoOtroListar">
        SELECT    CAST(p.persona as int ) as "persona",
               p.busqueda                         AS "busqueda",
               p.nombrecompleto                   AS "nombrecompleto",
               p.nombres                          AS "nombres",
               p.apellidopaterno                  AS "apellidopaterno",
               p.apellidomaterno                  AS "apellidomaterno",
               cast(p.sexo as varchar(5))                             AS "sexo",
               cast(p.tipodocumento  as varchar(5))                  AS "tipodocumento",
               cast(p.tipopersona  as varchar(5))                      AS "tipopersona",
               p.fechanacimiento                  AS "fechanacimiento",
               cast(p.escliente as varchar(5))                        AS "escliente",
               cast(p.esproveedor as varchar(5))                      AS "esproveedor",
               cast(p.esempleado as varchar(5))                       AS "esempleado",
               cast(p.esotro as varchar(5))                          AS "esotro",
               p.documento                        AS "documento",
               p.documentofiscal                  AS "documentofiscal",
               p.documentoidentidad               AS "documentoidentidad",
               p.correoelectronico               AS "correoelectronico",
               cast(p.estado as varchar(5))                           AS "estado",
               CASE WHEN p.estado = 'A' THEN 'Activo'
                 ELSE 'Inactivo' END              AS "estadoNombre",
               
               empleadomast.empleado         	  AS "empleado",  
               empleadomast.codigousuario         AS "codigousuario",
               cast(empleadomast.estadoempleado as varchar(5))        AS "estadoEmpleado",
               empleadomast.centrocostos          AS "centrocostos",               
               empleadomast.unidadnegocioasignada AS "unidadnegocioasignada",
               empleadomast.companiasocio         AS "companiasocio",               
               empleadomast.sucursal              AS "sucursal",               
               empleadomast.fechaingreso          AS "fechaingreso",
               empleadomast.fechainiciocontrato   AS "fechainiciocontrato",
               empleadomast.fechafincontrato      AS "fechafincontrato",
               empleadomast.tipohorario           AS "tipohorario",
               empleadomast.sueldoactuallocal     AS "sueldoactuallocal",
               empleadomast.codigocargo           AS "codigocargo",               
               empleadomast.tipocontrato          AS "tipocontrato",               
               empleadomast.tipoplanilla          AS "tipoplanilla",               
               empleadomast.cargo                 AS "cargo",               
               empleadomast.deptoorganizacion     AS "deptoorganizacion",
               empleadomast.correointerno     	  AS "correointerno",
               
               ma_unidadnegocio.descripcionlocal  AS "unidadnegocioasignadaNombre",
               ac_costcentermst.localname         AS "centrocostosNombre",
               COMP.description                   AS "companiasocioNombre",
               ac_sucursal.descripcionlocal       AS "sucursalnombre",
               pue.descripcion                    AS "codigocargoNombre",
               tcn.descripcion                    AS "tipocontratoNombre",
               tpl.descripcion                    AS "tipoplanillaNombre",
               dep.description                    AS "deptoorganizacionNombre",
               car.descripcionlocal               AS "cargoNombre"
        FROM personamast p
         JOIN empleadomast ON empleadomast.empleado=p.persona
         LEFT JOIN AC_COSTCENTERMST ON AC_COSTCENTERMST.COSTCENTER=EMPLEADOMAST.CENTROCOSTOS
         LEFT JOIN ma_unidadnegocio ON MA_UNIDADNEGOCIO.UNIDADNEGOCIO=EMPLEADOMAST.UNIDADNEGOCIOASIGNADA
         LEFT JOIN AC_SUCURSAL ON  AC_SUCURSAL.SUCURSAL=EMPLEADOMAST.SUCURSAL          
         LEFT JOIN companyowner comp ON comp.companyowner = empleadomast.companiasocio          
         
         LEFT JOIN HR_PUESTOEMPRESA PUE ON empleadomast.CodigoCargo = PUE.CodigoPuesto
		 LEFT JOIN HR_TipoContrato TCN ON empleadomast.TipoContrato = TCN.TipoContrato
		 LEFT JOIN PR_TipoPlanilla TPL ON empleadomast.TipoPlanilla = TPL.TipoPlanilla
		 LEFT JOIN hr_cargosmast CAR ON empleadomast.cargo = CAR.cargo
		 LEFT JOIN departmentmst DEP ON empleadomast.DeptoOrganizacion = DEP.department
	    WHERE 1=1
	    AND (p.esempleado = 'S' OR p.esotro = 'S')
	    AND p.persona = ISNULL(:p_codigo,p.persona)
	    AND upper(ISNULL(P.nombrecompleto,'xxx')) LIKE upper('%' + ISNULL(:p_nombre,ISNULL(P.nombrecompleto,'ISNULL') ) + '%')
	    AND ISNULL(p.documento,'ddd') LIKE '%' + ISNULL(:p_documento, ISNULL(P.documento,'ddd') ) + '%'
	    AND ISNULL(p.documentofiscal,'qqq') LIKE '%' + ISNULL(:p_docfiscal, ISNULL(P.documentofiscal,'qqq') ) + '%'
	    AND ISNULL(p.documentoidentidad,'eee') LIKE '%' + ISNULL(:p_docidentidad, ISNULL(P.documentoidentidad,'eee') ) + '%'
	    AND p.estado = ISNULL(:p_estado,p.estado)
	    order by p.busqueda
    </sql-query>
    
    <sql-query name="hrcapacitacion.paginadoEmpleadoOtroContar">
		SELECT count(1)
		FROM personamast p
         JOIN empleadomast ON empleadomast.empleado=p.persona
         LEFT JOIN AC_COSTCENTERMST ON AC_COSTCENTERMST.COSTCENTER=EMPLEADOMAST.CENTROCOSTOS
         LEFT JOIN ma_unidadnegocio ON MA_UNIDADNEGOCIO.UNIDADNEGOCIO=EMPLEADOMAST.UNIDADNEGOCIOASIGNADA
         LEFT JOIN AC_SUCURSAL ON  AC_SUCURSAL.SUCURSAL=EMPLEADOMAST.SUCURSAL          
         LEFT JOIN companyowner comp ON comp.companyowner = empleadomast.companiasocio  
         
         LEFT JOIN HR_PUESTOEMPRESA PUE ON empleadomast.CodigoCargo = PUE.CodigoPuesto
		 LEFT JOIN HR_TipoContrato TCN ON empleadomast.TipoContrato = TCN.TipoContrato
		 LEFT JOIN PR_TipoPlanilla TPL ON empleadomast.TipoPlanilla = TPL.TipoPlanilla
		 LEFT JOIN hr_cargosmast CAR ON empleadomast.cargo = CAR.cargo
		 LEFT JOIN departmentmst DEP ON empleadomast.DeptoOrganizacion = DEP.department
		WHERE 1=1
		AND (p.esempleado = 'S' OR p.esotro = 'S')
		AND p.persona = ISNULL(:p_codigo,p.persona)
		AND upper(ISNULL(P.nombrecompleto,'xxx')) LIKE
		upper('%' +
		ISNULL(:p_nombre,ISNULL(P.nombrecompleto,'ISNULL') ) + '%')
		AND ISNULL(p.documento,'ddd') LIKE '%' + ISNULL(:p_documento,
		ISNULL(P.documento,'ddd') ) + '%'
		AND ISNULL(p.documentofiscal,'qqq') LIKE
		'%' + ISNULL(:p_docfiscal,
		ISNULL(P.documentofiscal,'qqq') ) + '%'
		AND ISNULL(p.documentoidentidad,'eee') LIKE '%' + ISNULL(:p_docidentidad,
		ISNULL(P.documentoidentidad,'eee') ) + '%'
		AND p.estado = ISNULL(:p_estado,p.estado)
	</sql-query>
    
	
</hibernate-mapping>