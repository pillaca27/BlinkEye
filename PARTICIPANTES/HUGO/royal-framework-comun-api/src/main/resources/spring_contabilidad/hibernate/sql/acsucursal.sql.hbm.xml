<?xml version="1.0" encoding="UTF-8"?>
<!--
 *
 * @author : desarrollo
 * @powerbuilder : acreferenciafiscal
-->
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<hibernate-mapping>


	<sql-query name="acsucursal.listaractivos">
    	SELECT suc.Sucursal as "codigo"
			,suc.DescripcionLocal as "nombre"
			,CAST(suc.Estado as VARCHAR(1)) "estadoId"
		FROM AC_Sucursal suc
		WHERE suc.Estado = 'A' 
		order by DESCRIPCIONLOCAL
  	</sql-query>
  
  <sql-query name="acsucursal.listaractivosPorSeguridad">	
  	  SELECT AC_Sucursal.Sucursal as "codigo",   
         AC_Sucursal.DescripcionLocal  as "nombre"
      FROM AC_Sucursal  
      WHERE ( Sucursal in ( :p_sucursales ) ) OR  
         ( :p_todaslasSucursales = 'S' ) 
       </sql-query>   
    
	<sql-query name="acsucursal.listar">
    	SELECT suc.Sucursal as "codigo"
			,suc.DescripcionLocal as "nombre"
			,CAST(suc.Estado as VARCHAR(1)) "estadoId"
		FROM AC_Sucursal suc
		order by DESCRIPCIONLOCAL
  	</sql-query>
  	
  	<sql-query name="acsucursal.obtenertabla">
    	SELECT suc.Sucursal as "codigo"
			,suc.DescripcionLocal as "nombre"
			,CAST(suc.Estado as VARCHAR(1)) "estadoId"
		FROM AC_Sucursal suc
    	where SUCURSAL = :p_sucursal
  	</sql-query>
	
	<sql-query name="acsucursal.obtenerdto">
         select 
			SUCURSAL "sucursal"
			,DESCRIPCIONLOCAL "descripcionlocal"
			,DESCRIPCIONINGLES "descripcioningles"
			,SUCURSALGRUPO "sucursalgrupo"
			,CAST(Estado as VARCHAR(1)) "estado"
			,ULTIMOUSUARIO "ultimousuario"
			,ULTIMAFECHAMODIF "ultimafechamodif"
			,CUENTACONTABLEDEFECTO "cuentacontabledefecto"
         from AC_SUCURSAL
         where 
			SUCURSAL = :p_sucursal
    </sql-query>
    
  	
  	<sql-query name="acsucursal.listardtofiltros">
    	select 
			SUCURSAL "sucursal"
			,DESCRIPCIONLOCAL "descripcionlocal"
			,DESCRIPCIONINGLES "descripcioningles"
			,SUCURSALGRUPO "sucursalgrupo"
			,CAST(Estado as VARCHAR(1)) "estado"
			,ULTIMOUSUARIO "ultimousuario"
			,ULTIMAFECHAMODIF "ultimafechamodif"
			,CUENTACONTABLEDEFECTO "cuentacontabledefecto"
         from AC_SUCURSAL
		where 
				SUCURSAL = ISNULL(:p_sucursal,SUCURSAL)
			and UPPER(ISNULL(descripcionlocal,'xxx')) like '%' + ISNULL(:p_descripcionlocal,UPPER(descripcionlocal)) + '%'
			and ISNULL(ESTADO,'xx') = ISNULL(:p_estado,ISNULL(ESTADO,'xx'))
		order by DESCRIPCIONLOCAL
  	</sql-query>
  	
  	<sql-query name="acsucursal.obtenerSucursalPorSucursalAndGrupo">
         select 
			SUCURSAL "sucursal"
			,DESCRIPCIONLOCAL "descripcionlocal"
			,DESCRIPCIONINGLES "descripcioningles"
			,SUCURSALGRUPO "sucursalgrupo"
			,CAST(Estado as VARCHAR(1)) "estado"
			,ULTIMOUSUARIO "ultimousuario"
			,ULTIMAFECHAMODIF "ultimafechamodif"
			,CUENTACONTABLEDEFECTO "cuentacontabledefecto"
         from AC_SUCURSAL
         where 
			SUCURSAL = :p_sucursal
			and SUCURSALGRUPO = :p_gruposucursal
    </sql-query>
    
    
    <sql-query name="acsucursal.listarPaginadoContar">
         select 
			 count(1)
         from AC_SUCURSAL
         where 
			Estado = :p_estado
			AND SUCURSAL=ISNULL(:p_sucursal,SUCURSAL)
			and UPPER(ISNULL(DESCRIPCIONLOCAL,'xxx')) like '%' + ISNULL(:p_descripcion,UPPER(DESCRIPCIONLOCAL)) + '%'
    </sql-query>
    
        <sql-query name="acsucursal.listarPaginadoSentencia">
         select 
			SUCURSAL "sucursal"
			,DESCRIPCIONLOCAL "descripcionlocal"
			,DESCRIPCIONINGLES "descripcioningles"
			,SUCURSALGRUPO "sucursalgrupo"
			,CAST(Estado as VARCHAR(1)) "estado"
			,ULTIMOUSUARIO "ultimousuario"
			,ULTIMAFECHAMODIF "ultimafechamodif"
			,CUENTACONTABLEDEFECTO "cuentacontabledefecto"
         from AC_SUCURSAL
         where 
			Estado = :p_estado
			AND SUCURSAL=ISNULL(:p_sucursal,SUCURSAL)
			and UPPER(ISNULL(DESCRIPCIONLOCAL,'xxx')) like '%' + ISNULL(:p_descripcion,UPPER(DESCRIPCIONLOCAL)) + '%'
			
    </sql-query>
  
  
     <sql-query name="acsucursal.contarsucursalporfiltro">
SELECT 
COUNT(*)
FROM AC_SUCURSAL 
WHERE ( 
	EXISTS (	SELECT * 
				FROM HR_SEGURIDAD 
				WHERE AC_SUCURSAL.SUCURSAL = HR_SEGURIDAD.VALORTEXTO 
					AND HR_SEGURIDAD.CONCEPTOSEGURIDAD = 'TIPOSU' 
					AND HR_SEGURIDAD.USUARIO = :p_usuario )
	OR						
	(	SELECT COUNT(1) 
		FROM HR_SEGURIDAD 
		WHERE HR_SEGURIDAD.CONCEPTOSEGURIDAD = 'ALLSUCURS' 
			AND HR_SEGURIDAD.USUARIO = :p_usuario ) > 0
	)
	OR
	(	SELECT COUNT(1) 
		FROM SEGURIDADAUTORIZACIONES 
		WHERE APLICACIONCODIGO = 'HR' 
			AND GRUPO = 'SYSTEM' 
			AND CONCEPTO = 'SYSADM'
			AND USUARIO = :p_usuario ) > 0
AND (ISNULL(:p_sucursal, '-') = '-' OR AC_SUCURSAL.SUCURSAL = :p_sucursal)
AND (ISNULL(:p_descripcionlocal, '-') = '-' OR AC_SUCURSAL.DESCRIPCIONLOCAL LIKE '%'+isnull(:p_descripcionlocal, AC_SUCURSAL.DESCRIPCIONLOCAL)+'%')	

    </sql-query>
    
        <sql-query name="acsucursal.listarsucursalporfiltro">
SELECT 
CAST(AC_SUCURSAL.SUCURSAL AS VARCHAR) AS sucursal, 
LTRIM(RTRIM(UPPER(AC_SUCURSAL.DESCRIPCIONLOCAL))) AS descripcionlocal,
CAST(AC_SUCURSAL.ESTADO AS VARCHAR) AS estado
FROM AC_SUCURSAL 
WHERE ( 
	EXISTS (	SELECT * 
				FROM HR_SEGURIDAD 
				WHERE AC_SUCURSAL.SUCURSAL = HR_SEGURIDAD.VALORTEXTO 
					AND HR_SEGURIDAD.CONCEPTOSEGURIDAD = 'TIPOSU' 
					AND HR_SEGURIDAD.USUARIO = :p_usuario )
	OR						
	(	SELECT COUNT(1) 
		FROM HR_SEGURIDAD 
		WHERE HR_SEGURIDAD.CONCEPTOSEGURIDAD = 'ALLSUCURS' 
			AND HR_SEGURIDAD.USUARIO = :p_usuario ) > 0
	)
	OR
	(	SELECT COUNT(1) 
		FROM SEGURIDADAUTORIZACIONES 
		WHERE APLICACIONCODIGO = 'HR' 
			AND GRUPO = 'SYSTEM' 
			AND CONCEPTO = 'SYSADM'
			AND USUARIO = :p_usuario ) > 0
AND (ISNULL(:p_sucursal, '-') = '-' OR AC_SUCURSAL.SUCURSAL = :p_sucursal)
AND (ISNULL(:p_descripcionlocal, '-') = '-' OR AC_SUCURSAL.DESCRIPCIONLOCAL LIKE '%'+isnull(:p_descripcionlocal, AC_SUCURSAL.DESCRIPCIONLOCAL)+'%')	
ORDER BY AC_SUCURSAL.DESCRIPCIONLOCAL
			
    </sql-query>  
    
</hibernate-mapping>
